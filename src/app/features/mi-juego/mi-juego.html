<section class="preg">
  <div class="home-grid">
    <div class="about-card blue-skin">
      <a routerLink="/home" class="btn btn-back">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 20 20"
          fill="currentColor"
          class="icon"
        >
          <path
            fill-rule="evenodd"
            d="M9.293 2.293a1 1 0 011.414 0l7 7A1 1 0 0117 10.707V16.5a1.5 1.5 0 01-1.5-1.5h-3.5a.5.5 0 01-.5-.5v-4.5a.5.5 0 00-.5-.5h-2a.5.5 0 00-.5.5V17a.5.5 0 01-.5.5H5a1.5 1.5 0 01-1.5-1.5V10.707a1 1 0 01.293-.707l7-7z"
            clip-rule="evenodd"
          />
        </svg>
        <span>Volver al Home</span>
      </a>

      <div class="hero">
        <h2>Juego de Secuencias</h2>
      </div>

      <div class="panel">
        @if (gameState() === 'playing' || gameState() === 'showingResult') { @if
        (r()) {
        <p class="meta">
          Ronda {{ round() + 1 }} / {{ ROUNDS }} | Puntos: {{ score() }}
        </p>
        <div class="series-container">
          <p class="series">
            @for (n of r()!.series; track n) {
            <span>{{ n }}</span>
            }
            <span>... ?</span>
          </p>
        </div>
        <div class="options">
          @for (opt of r()!.options; track opt) {
          <button
            class="opt btn primary"
            [class.correct]="gameState() === 'showingResult' && opt === r()!.correct"
            [class.wrong]="gameState() === 'showingResult' && opt === picked() && opt !== r()!.correct"
            [disabled]="gameState() === 'showingResult'"
            (click)="pick(opt)"
          >
            {{ opt }}
          </button>
          }
        </div>
        @if (gameState() === 'showingResult') {
        <div class="feedback">
          @if (picked() === r()!.correct) {
          <p class="ok">¡Correcto!</p>
          } @else {
          <p class="err">Incorrecto. Era <b>{{ r()!.correct }}</b>.</p>
          }
          <div class="bottom-actions">
            <button class="btn btn-reset" (click)="reset()">
              <span class="icon" aria-hidden="true">↻</span>
              <span>Reiniciar</span>
            </button>
            <button class="btn secondary" (click)="next()">Siguiente</button>
          </div>
        </div>
        } @else {
        <div class="feedback-placeholder">
          <div class="bottom-actions">
            <button class="btn btn-reset" (click)="reset()">
              <span class="icon" aria-hidden="true">↻</span>
              <span>Reiniciar</span>
            </button>
          </div>
        </div>
        } } @else {
        <div class="status-box">Cargando...</div>
        } } @else if (gameState() === 'confirmReset') {
        <div class="confirm-dialog">
          <h3>¿Reiniciar partida?</h3>
          <p>Se perderá el progreso de la ronda actual.</p>
          <div class="button-group">
            <button class="btn btn-reset" (click)="handleResetChoice(true)">
              Sí, reiniciar
            </button>
            <button class="btn secondary" (click)="handleResetChoice(false)">
              Cancelar
            </button>
          </div>
        </div>
        } @else if (gameState() === 'askReplay') {
        <div class="end-game replay-prompt">
          <h3>Partida terminada</h3>
          <p>Puntaje Final: <b>{{ score() }}</b> / {{ ROUNDS }}</p>
          <p class="replay-question">¿Quieres jugar de nuevo?</p>
          <div class="button-group">
            <button class="btn primary" (click)="handleReplayChoice(true)">
              Sí
            </button>
            <button class="btn secondary" (click)="handleReplayChoice(false)">
              No
            </button>
          </div>
        </div>
        } @else if (gameState() === 'finished' || gameState() === 'loading') {
        <div class="status-box">Cargando...</div>
        }
      </div>
    </div>
  </div>
</section>
